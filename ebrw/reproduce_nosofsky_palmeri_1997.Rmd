---
title: "Reproduction of model-based analysis by Nosofsky & Palmeri (1997)"
author: "Frederik Aust"
output:
  knitrBootstrap::bootstrap_document:
    highlight: xcode
    theme: flatly
    menu: false
---

To validate this implementation of the Exemplar-Based Random Walk model (EBRW) for categorization data, I reproduced small parts of the model-based analyses reported in Nosofsky & Palmeri (1997). The original MDS solution was extracted from Figure 4 using 
[WebPlotDigitizer](http://arohatgi.info/WebPlotDigitizer/).

```{r echo = FALSE, message = FALSE}
source("ebrw_pred.R")
```

# Experiment 1, Participant 3

```{r data}
# MDS solution
similarities <- data.frame(
  saturation = c(-1.891, -0.588, -1.054, 0.224, -1.067, 0.249, 1.482, -0.466, 1.272, 0.217, 0.748, 1.016)
  , brightness = c(0.778, 1.059, 0.246, 1.049, -0.630, 0.495, 1.188, -0.693, 0.389, -2.024, -1.500, -0.372)
  , cat = c(1, 2, 2, 2, 1, 2, 2, 1, 2, 1, 1, 1)
)

# Observed and predicted data (Table C1, Nosofsky & Palmeri, 1997)
nosofsky_palmeri <- list()
nosofsky_palmeri$observed$correct <- c(0.975, 1.000, 0.956, 1.000, 1.000, 1.000, 1.000, 0.984, 0.984, 1.000, 1.000, 0.934)
nosofsky_palmeri$observed$rt <- c(780, 709, 962, 661, 841, 749, 641, 834, 834, 697, 779, 1007)
nosofsky_palmeri$predicted$correct <- c(99.84, 99.93, 94.67, 99.99, 99.12, 99.88, 100, 99.26, 99.69, 100, 99.99, 93.78)
nosofsky_palmeri$predicted$rt <- c(766.33, 740.77, 985.17, 706.54, 837.17, 753.02, 692.40, 827.37, 786.71, 684.81, 710.44, 1003.30)

# Best fitting parameters (Tabel C2, Nosofsky & Palmeri, 1997)
best_param <- c(w = 0.716, c = 2.196, K = 5, alpha = 0.242, k = 125.07, mu = 491.07)
```

<br />

## Summary fits

When comparing the predictions generated by this implementation of EBRW note that the MDS solution the predictions rely on is an approximation of the solution used by Nosofsky & Palmeri (1997). Especially the exact values for Stimulus 3 and 12 were difficult to extract due to the large diameter of the corresponding points in Figure 4. Minor numerical deviations of the prediction pattern are to be expected.

```{r prediction}
blocked_predictions <- data.frame()
for(i in 31:150) {
  predicted_responses <- ebrw_pred(
    best_param
    , mem = similarities[rep(seq_len(nrow(similarities)), i-1), ]
    , obs = similarities
    , rho = 2
  )[, c(1, 4)]
  blocked_predictions <- rbind(blocked_predictions, cbind(Stimulus = 1:12, block = i, predicted_responses))
}

average_predictions <- aggregate(cbind(accuracy, mean_rt) ~ Stimulus, blocked_predictions, mean)
```

<br />

### Categorization responses

The predicted accuracy of categorization responses closely follows the predictions reported by Nosofsky & Palmeri (1997), $r = `r round(cor(nosofsky_palmeri$predicted$correct, round(average_predictions$accuracy * 100)), 3)`$.

```{r categorizations, results = "asis", echo = FALSE}
knitr::kable(cbind(
  average_predictions$Stimulus
  , `Predictions by Nofsoky & Palmeri (1997)` = nosofsky_palmeri$predicted$correct
  , `Predictions of this implementation` = round(average_predictions$accuracy * 100, 2)
  , `$\\Delta$` = nosofsky_palmeri$predicted$correct - round(average_predictions$accuracy * 100, 2)
))
```

<br />

### Response times

Again, the predicted response times closely follow the predictions reported by Nosofsky & Palmeri (1997), $r = `r round(cor(nosofsky_palmeri$predicted$rt, round(average_predictions$mean_rt)), 3)`$.

```{r response_times, results = "asis", echo = FALSE}
knitr::kable(cbind(
  average_predictions$Stimulus
  , `Predictions by Nofsoky & Palmeri (1997)` = nosofsky_palmeri$predicted$rt
  , `Predictions of this implementation` = round(average_predictions$mean_rt, 2)
  , `$\\Delta$` = nosofsky_palmeri$predicted$rt - round(average_predictions$mean_rt, 2)
))
```

# EBRW as generalization of GCM

As explained by Nosofsky & Palmeri (1997, p. 270) the response rule implemented in EBRW is a generalization of GCM. The models'  predictions of response probabilities are identical if $K = A = B = 1$.

```{r}
source("../generalized_context_model/gcm_pred.r")

ebrw_accuracy <- ebrw_pred(
  c(w = 0.716, c = 2.196, K = 1, alpha = 0, k = 1, mu = 0)
  , mem = similarities
  , obs = similarities
  , rho = 2
)[, "accuracy"]

gcm_pa <- gcm_pred(
  c(w = 0.716, c = 2.196, b = 0.5)
  , mem = similarities
  , obs = similarities[, -3]
  , rho = 2
  , p = 1
)[, 1]

gcm_accuracy <- gcm_pa
gcm_accuracy[similarities$cat == 2] <- 1 - gcm_pa[similarities$cat == 2]
```

```{r echo = FALSE, results = "asis"}
knitr::kable(cbind(
  average_predictions$Stimulus
  , `EBRW` = round(ebrw_accuracy * 100, 2)
  , `GCM` = round(gcm_accuracy * 100, 2)
  , `$\\Delta$` = round((ebrw_accuracy - gcm_accuracy) * 100, 2)
))
```



# References
Nosofsky, R. M., & Palmeri, T. J. (1997). An exemplar-based random walk model of speeded classification. *Psychological Review*, 104(2), 266â€“300. doi:[10.1037/0033-295X.104.2.266](https://doi.org/10.1037/0033-295X.104.2.266)

